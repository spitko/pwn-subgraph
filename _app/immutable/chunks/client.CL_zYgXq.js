var j=Object.defineProperty;var E=(n,e,r)=>e in n?j(n,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[e]=r;var h=(n,e,r)=>(E(n,typeof e!="symbol"?e+"":e,r),r);import{A as p,D as g,d as v,m as C,l as F,g as S,f as N,c as m,a as T}from"./2.BtfAXEZA.js";import"./session.Cfr_vwnx.js";const A=n=>()=>({async network(e,{client:r,initialValue:t,resolve:a,marshalVariables:s}){if(e.artifact.kind===p.Fragment)return a(e,t);const i=e.fetch??globalThis.fetch,o={name:e.name,text:e.text,hash:e.hash,variables:s(e)},l=await L(r.url,e.fetchParams)({fetch:(f,u)=>{const d=_(o,u)??u;return i(f,d)},metadata:e.metadata,session:e.session||{},...o});a(e,{fetching:!1,variables:e.variables??{},data:l.data,errors:!l.errors||l.errors.length===0?null:l.errors,partial:!1,stale:!1,source:g.Network})}}),L=(n,e)=>{if(!n)throw new Error("Could not find configured client url. Please specify one in your HoudiniClient constructor.");return async({fetch:r,name:t,text:a,variables:s})=>await(await r(n,{method:"POST",body:JSON.stringify({operationName:t,query:a,variables:s}),...e,headers:{Accept:"application/graphql+json, application/json","Content-Type":"application/json",...e==null?void 0:e.headers}})).json()};function _(n,e){const{files:r}=k({variables:n.variables});if(r.size){const t=e;let a={};if(t!=null&&t.headers){const c=Object.entries(t==null?void 0:t.headers).filter(([l,f])=>!(l.toLowerCase()=="content-type"&&f.toLowerCase()=="application/json"));a=Object.fromEntries(c)}const s=new FormData;e&&(e!=null&&e.body)?s.set("operations",e==null?void 0:e.body):s.set("operations",JSON.stringify({operationName:n.name,query:n.text,variables:n.variables}));const i={};let o=0;return r.forEach(c=>{i[++o]=c}),s.set("map",JSON.stringify(i)),o=0,r.forEach((c,l)=>{s.set(`${++o}`,l,l.name)}),{...t,headers:a,body:s}}}function D(n){return typeof File<"u"&&n instanceof File||typeof Blob<"u"&&n instanceof Blob}function k(n){if(!arguments.length)throw new TypeError("Argument 1 `value` is required.");const e=new Map,r=new Map;function t(a,s,i){if(D(a)){const l=r.get(a);return l?l.push(s):r.set(a,[s]),null}const o=Array.isArray(a)||typeof FileList<"u"&&a instanceof FileList,c=I(a);if(o||c){let l=e.get(a);const f=!l;if(f&&(l=o?[]:a instanceof Object?{}:Object.create(null),e.set(a,l)),!i.has(a)){const u=s?`${s}.`:"",d=new Set(i).add(a);if(o){let y=0;for(const b of a){const O=t(b,u+y++,d);f&&l.push(O)}}else for(const y in a){const b=t(a[y],u+y,d);f&&(l[y]=b)}}return l}return a}return{clone:t(n,"",new Set),files:r}}function I(n){if(typeof n!="object"||n===null)return!1;const e=Object.getPrototypeOf(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)}const w=(n,e)=>()=>{const r=e(),t=s=>s?(i,o)=>i.artifact.kind!==n?o.next(i):s(i,o):void 0,a=s=>s?(i,o)=>i.artifact.kind!==n?o.resolve(i):s(i,o):void 0;return{start:t(r.start),network:t(r.network),afterNetwork:a(r.afterNetwork),end:a(r.end),catch:r.catch?(s,i)=>r.catch(s,i):void 0,cleanup:(...s)=>{var i;return(i=r.cleanup)==null?void 0:i.call(r,...s)}}},q=n=>w(p.Query,function(){let e=null,r=null;return{start(t,{next:a}){var i;const s={session:t.session};t.variables={...r,...Object.fromEntries(Object.entries(((i=t.artifact.input)==null?void 0:i.runtimeScalars)??{}).map(([o,c])=>{var f,u;const l=(u=(f=t.config.features)==null?void 0:f.runtimeScalars)==null?void 0:u[c];return l?[o,l.resolve(s)]:[o,c]})),...t.variables},a(t)},end(t,{resolve:a,marshalVariables:s,variablesChanged:i}){var o,c;if(i(t)&&!((o=t.cacheParams)!=null&&o.disableSubscriptions)){e&&n.unsubscribe(e,((c=e.variables)==null?void 0:c.call(e))||{}),r={...s(t)};const l=r;e={rootType:t.artifact.rootType,selection:t.artifact.selection,variables:()=>l,set:f=>{a(t,{data:f,errors:null,fetching:!1,partial:!1,stale:!1,source:g.Cache,variables:t.variables??{}})}},n.subscribe(e,r)}a(t)},cleanup(){var t;e&&(n.unsubscribe(e,(t=e.variables)==null?void 0:t.call(e)),r=null)}}}),M=n=>w(p.Fragment,function(){let e=null,r=null;return{start(t,{next:a,resolve:s,variablesChanged:i,marshalVariables:o}){var l,f;if(!t.stuff.parentID)return a(t);const c={parent:t.stuff.parentID,variables:o(t)};if(!((l=t.cacheParams)!=null&&l.disableSubscriptions)&&(!v(r,c)||i(t))){e&&n.unsubscribe(e,((f=e.variables)==null?void 0:f.call(e))||{});const u=o(t);e={rootType:t.artifact.rootType,selection:t.artifact.selection,variables:()=>u,parentID:t.stuff.parentID,set:d=>{s(t,{data:d,errors:null,fetching:!1,partial:!1,stale:!1,source:g.Cache,variables:u})}},n.subscribe(e,u),r=c}a(t)},cleanup(){var t;e&&n.unsubscribe(e,(t=e.variables)==null?void 0:t.call(e))}}}),R=n=>w(p.Mutation,()=>({async start(e,{next:r,marshalVariables:t}){const a=n._internal_unstable.storage.createLayer(!0),s=e.stuff.optimisticResponse;let i=[];s&&(i=n.write({selection:e.artifact.selection,data:await C({selection:e.artifact.selection,data:s}),variables:t(e),layer:a.id})),e.cacheParams={...e.cacheParams,layer:a,notifySubscribers:i,forceNotify:!0},r(e)},afterNetwork(e,{resolve:r}){var t;(t=e.cacheParams)!=null&&t.layer&&n.clearLayer(e.cacheParams.layer.id),r(e)},end(e,{resolve:r,value:t}){var s,i;t.errors&&t.errors.length>0&&(s=e.cacheParams)!=null&&s.layer&&n.clearLayer(e.cacheParams.layer.id),(i=e.cacheParams)!=null&&i.layer&&n._internal_unstable.storage.resolveLayer(e.cacheParams.layer.id),r(e)},catch(e,{error:r}){var t;if((t=e.cacheParams)!=null&&t.layer){const{layer:a}=e.cacheParams;n.clearLayer(a.id),n._internal_unstable.storage.resolveLayer(a.id)}throw r}})),H=({operations:n,error:e})=>()=>{const r=n.includes("all"),t=a=>r||{[p.Query]:n.includes("query"),[p.Mutation]:n.includes("mutation"),[p.Fragment]:!1,[p.Subscription]:n.includes("subscription")}[a];return{async end(a,{value:s,resolve:i}){if(s.errors&&s.errors.length>0&&t(a.artifact.kind))throw await(e??J)(s.errors,a);i(a)}}},J=async n=>new Error(n.map(e=>e.message).join(". ")+"."),$=(n=()=>({}))=>()=>({start(e,{next:r,marshalVariables:t}){r({...e,fetchParams:n({config:e.config,policy:e.policy,metadata:e.metadata,session:e.session,stuff:e.stuff,document:e.artifact,variables:t(e),text:e.text,hash:e.hash})})}}),B=[];var K=B;class Q{constructor({url:e,fetchParams:r,plugins:t,pipeline:a,throwOnError:s}={}){h(this,"url");h(this,"throwOnError_operations");h(this,"cache",null);h(this,"throwOnError");h(this,"fetchParams");h(this,"pipeline");h(this,"extraPlugins");h(this,"proxies",{});h(this,"componentCache",{});var o,c;if(t&&a)throw new Error("A client cannot be given a pipeline and a list of plugins at the same time.");this.throwOnError_operations=(s==null?void 0:s.operations)??[];let i=((c=(o=globalThis.process)==null?void 0:o.env)==null?void 0:c.HOUDINI_PORT)??"5173";this.url=e??(globalThis.window?"":`https://localhost:${i}`)+F(S()),this.throwOnError=s,this.fetchParams=r,this.pipeline=a,this.extraPlugins=t}setCache(e){this.cache=e}get plugins(){return N([].concat(this.throwOnError?[H(this.throwOnError)]:[],$(this.fetchParams),this.pipeline??[q(this.cache??m),R(this.cache??m),M(this.cache??m)].concat(this.extraPlugins??[],K,A())))}observe({enableCache:e=!0,fetching:r=!1,...t}){return new T({client:this,plugins:P(this.plugins),fetching:r,enableCache:e,cache:this.cache??void 0,...t})}registerProxy(e,r){this.proxies[e]=r}}function P(n){return n.reduce((e,r)=>{if(typeof r!="function")throw new Error("Encountered client plugin that's not a function");const t=r();if(!t)return e;if(!Array.isArray(t))return e.concat(t);for(const a of t)if(a){if(typeof a=="function")return e.concat(P([a]));e.push(a)}return e},[])}const G=new Q({url:"https://api.studio.thegraph.com/query/25077/pwn/version/latest"});export{G as default};
